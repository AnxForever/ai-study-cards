<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå¯¹è¯çŸ¥è¯†å¡ç‰‡ç”Ÿæˆå™¨</title>
    <meta name="description" content="å°†AIå¯¹è¯è‡ªåŠ¨æ•´ç†æˆObsidiançŸ¥è¯†å¡ç‰‡ï¼ŒåŠ©åŠ›è€ƒç ”å¤ä¹ ">
    <meta name="theme-color" content="#4f46e5">
    <link rel="icon" type="image/png" href="public/icon-192.png">
    <link rel="manifest" href="public/manifest.json">
    <link rel="stylesheet" href="src/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .step {
            margin-bottom: 40px;
            padding: 30px;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            background: #f9fafb;
            transition: all 0.3s ease;
        }
        
        .step:hover {
            border-color: #4f46e5;
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.1);
            transform: translateY(-2px);
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .step h3 {
            color: #1f2937;
            font-size: 1.4rem;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        textarea {
            min-height: 200px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }
        
        button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .output-section {
            background: #1f2937;
            color: #f9fafb;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }
        
        .output-section h3 {
            color: #60a5fa;
            margin-bottom: 20px;
        }
        
        .card-preview {
            background: #374151;
            border-radius: 10px;
            padding: 25px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .download-btn {
            margin-top: 20px;
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        .download-btn:hover {
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.4);
        }
        
        .tips {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .tips h4 {
            margin-bottom: 10px;
        }
        
        .tips ul {
            margin-left: 20px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  AIå¯¹è¯çŸ¥è¯†å¡ç‰‡ç”Ÿæˆå™¨</h1>
            <p>å°†AIå¯¹è¯è‡ªåŠ¨æ•´ç†æˆObsidiançŸ¥è¯†å¡ç‰‡</p>
        </div>
        
        <div class="main-content">
            <div class="step">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h3>é…ç½®å¡ç‰‡ä¿¡æ¯</h3>
                </div>
                
                <div class="form-group">
                    <label for="subject">å­¦ç§‘åˆ†ç±»</label>
                    <select id="subject">
                        <option value="é«˜ç­‰æ•°å­¦">é«˜ç­‰æ•°å­¦</option>
                        <option value="çº¿æ€§ä»£æ•°">çº¿æ€§ä»£æ•°</option>
                        <option value="408æ•°æ®ç»“æ„">408-æ•°æ®ç»“æ„</option>
                        <option value="408ç®—æ³•">408-ç®—æ³•</option>
                        <option value="408è®¡ç½‘">408-è®¡ç®—æœºç½‘ç»œ</option>
                        <option value="408æ“ä½œç³»ç»Ÿ">408-æ“ä½œç³»ç»Ÿ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="topic">ä¸»é¢˜/çŸ¥è¯†ç‚¹</label>
                    <input type="text" id="topic" placeholder="ä¾‹å¦‚ï¼šæé™çš„å››åˆ™è¿ç®—æ³•åˆ™">
                </div>
                
                <div class="form-group">
                    <label for="difficulty">éš¾åº¦ç­‰çº§</label>
                    <select id="difficulty">
                        <option value="åŸºç¡€">åŸºç¡€</option>
                        <option value="ä¸­ç­‰">ä¸­ç­‰</option>
                        <option value="å›°éš¾">å›°éš¾</option>
                    </select>
                </div>
            </div>
            
            <div class="step">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h3>ç²˜è´´AIå¯¹è¯å†…å®¹</h3>
                </div>
                
                <div class="form-group">
                    <label for="dialogue">å¯¹è¯å†…å®¹</label>
                    <textarea id="dialogue" placeholder="è¯·ç²˜è´´ä½ ä¸AIçš„å®Œæ•´å¯¹è¯å†…å®¹..."></textarea>
                </div>
                
                <button onclick="processDialogue()">ğŸš€ ç”ŸæˆçŸ¥è¯†å¡ç‰‡</button>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆ†æå¯¹è¯å†…å®¹ï¼Œç”ŸæˆçŸ¥è¯†å¡ç‰‡...</p>
                </div>
            </div>
            
            <div class="output-section" id="output" style="display: none;">
                <h3>ğŸ“‹ ç”Ÿæˆçš„çŸ¥è¯†å¡ç‰‡</h3>
                <div class="card-preview" id="cardPreview"></div>
                
                <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                    <button class="download-btn" onclick="downloadCard()">ğŸ’¾ ä¸‹è½½å•ä¸ªæ–‡ä»¶</button>
                    <button class="download-btn" onclick="copyToClipboard()" style="background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
                    <button class="download-btn" onclick="showObsidianGuide()" style="background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);">ğŸ”— Obsidianå¯¼å…¥æŒ‡å—</button>
                </div>
                
                <div id="obsidianGuide" style="display: none; margin-top: 25px; padding: 25px; background: #1e293b; border-radius: 10px; border-left: 4px solid #3b82f6;">
                    <h4 style="color: #60a5fa; margin-bottom: 15px;">ğŸ“– Obsidianå¯¼å…¥æŒ‡å—</h4>
                    <div style="color: #cbd5e1; line-height: 1.6;">
                        <p><strong>æ–¹æ³•ä¸€ï¼šç›´æ¥å¯¼å…¥</strong></p>
                        <ol style="margin: 10px 0 20px 20px;">
                            <li>ç‚¹å‡»"å¤åˆ¶åˆ°å‰ªè´´æ¿"æŒ‰é’®</li>
                            <li>åœ¨Obsidianä¸­æŒ‰ <code>Ctrl+N</code> åˆ›å»ºæ–°ç¬”è®°</li>
                            <li>æŒ‰ <code>Ctrl+V</code> ç²˜è´´å†…å®¹</li>
                            <li>ä¿å­˜ç¬”è®°ï¼ˆå»ºè®®æ–‡ä»¶åæ ¼å¼ï¼š<code>æ—¥æœŸ-ä¸»é¢˜.md</code>ï¼‰</li>
                        </ol>
                        
                        <p><strong>æ–¹æ³•äºŒï¼šæ–‡ä»¶å¯¼å…¥</strong></p>
                        <ol style="margin: 10px 0 20px 20px;">
                            <li>ç‚¹å‡»"ä¸‹è½½å•ä¸ªæ–‡ä»¶"æŒ‰é’®</li>
                            <li>å°†ä¸‹è½½çš„.mdæ–‡ä»¶æ‹–æ‹½åˆ°Obsidianåº“æ–‡ä»¶å¤¹</li>
                            <li>åœ¨Obsidianä¸­åˆ·æ–°æ–‡ä»¶åˆ—è¡¨</li>
                        </ol>
                        
                        <p><strong>å»ºè®®çš„æ–‡ä»¶å¤¹ç»“æ„ï¼š</strong></p>
                        <pre style="background: #0f172a; padding: 15px; border-radius: 8px; margin: 10px 0; overflow-x: auto;">ğŸ“ è€ƒç ”çŸ¥è¯†åº“/
â”œâ”€â”€ ğŸ“ 01-é«˜ç­‰æ•°å­¦/
â”‚   â”œâ”€â”€ ğŸ“ æé™ä¸è¿ç»­/
â”‚   â”œâ”€â”€ ğŸ“ å¯¼æ•°ä¸å¾®åˆ†/
â”‚   â””â”€â”€ ğŸ“ ç§¯åˆ†å­¦/
â”œâ”€â”€ ğŸ“ 02-çº¿æ€§ä»£æ•°/
â”œâ”€â”€ ğŸ“ 03-408ä¸“ä¸šè¯¾/
â”œâ”€â”€ ğŸ“ Templates/
â””â”€â”€ ğŸ“ AIå¯¹è¯æ•´ç†/</pre>
                    </div>
                </div>
            </div>
            
            <div class="step">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h3>æ‰¹é‡å¤„ç†ä¸ç®¡ç†</h3>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <button onclick="addToBatch()" style="background: linear-gradient(135deg, #059669 0%, #047857 100%);">â• æ·»åŠ åˆ°æ‰¹é‡é˜Ÿåˆ—</button>
                    <button onclick="showBatchQueue()" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);">ğŸ“‹ æŸ¥çœ‹æ‰¹é‡é˜Ÿåˆ— (<span id="batchCount">0</span>)</button>
                </div>
                
                <div id="batchQueue" style="display: none; background: #f3f4f6; padding: 20px; border-radius: 10px; margin-top: 15px;">
                    <h4 style="margin-bottom: 15px; color: #374151;">æ‰¹é‡å¤„ç†é˜Ÿåˆ—</h4>
                    <div id="batchList" style="margin-bottom: 15px;"></div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="downloadAllCards()" class="download-btn">ğŸ“¦ æ‰“åŒ…ä¸‹è½½å…¨éƒ¨</button>
                        <button onclick="clearBatch()" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">ğŸ—‘ï¸ æ¸…ç©ºé˜Ÿåˆ—</button>
                    </div>
                </div>
                
                <div class="tips" style="margin-top: 20px;">
                    <h4>ğŸ¯ æ‰¹é‡å¤„ç†ä¼˜åŠ¿</h4>
                    <ul>
                        <li>ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªå¯¹è¯ä¸»é¢˜</li>
                        <li>ç»Ÿä¸€çš„æ–‡ä»¶å‘½åå’Œç»„ç»‡ç»“æ„</li>
                        <li>æ”¯æŒæ‰“åŒ…ä¸‹è½½ï¼Œæ–¹ä¾¿å¯¼å…¥Obsidian</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let generatedCard = '';
        let batchQueue = [];

        function processDialogue() {
            const subject = document.getElementById('subject').value;
            const topic = document.getElementById('topic').value;
            const difficulty = document.getElementById('difficulty').value;
            const dialogue = document.getElementById('dialogue').value;

            if (!topic || !dialogue) {
                alert('è¯·å¡«å†™ä¸»é¢˜å’Œå¯¹è¯å†…å®¹ï¼');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').style.display = 'block';
            document.getElementById('output').style.display = 'none';

            // æ¨¡æ‹Ÿå¤„ç†è¿‡ç¨‹
            setTimeout(() => {
                const card = generateKnowledgeCard(subject, topic, difficulty, dialogue);
                displayCard(card);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('output').style.display = 'block';
            }, 2000);
        }

        function generateKnowledgeCard(subject, topic, difficulty, dialogue) {
            const today = new Date().toISOString().split('T')[0];
            const filename = `${today}-${topic.replace(/\s+/g, '-')}`;
            
            // æ”¹è¿›çš„å†…å®¹æå–é€»è¾‘
            const sections = analyzeDialogue(dialogue);

            const card = `# ${topic}

## ğŸ·ï¸ æ ‡ç­¾
#${subject.replace(/[\s-]/g, '/')} #éš¾åº¦/${difficulty} #AIå¯¹è¯æ•´ç† #å¤ä¹ 

## ğŸ“š å­¦ç§‘åˆ†ç±»
**ä¸»åˆ†ç±»**ï¼š${subject}  
**éš¾åº¦ç­‰çº§**ï¼š${difficulty}  
**çŸ¥è¯†ç‚¹ç±»å‹**ï¼š${sections.topicType}

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
${sections.concepts}

## ğŸ§® å…¬å¼å®šç†
${sections.formulas}

## ğŸ” ä¾‹é¢˜åˆ†æ
${sections.examples}

## ğŸ’¡ è§£é¢˜æ€è·¯
${sections.solvingSteps}

## âš ï¸ æ˜“é”™æé†’
${sections.warnings}

## ğŸ”— ç›¸å…³çŸ¥è¯†ç‚¹
${sections.relatedTopics}

## ğŸ“ˆ çŸ¥è¯†æ‹“å±•
${sections.extensions}

## ğŸ“… å¤ä¹ è®¡åˆ’
- [ ] ç¬¬1æ¬¡å¤ä¹ ï¼ˆç†è§£æ¦‚å¿µï¼‰ğŸ“… ${getDateAfterDays(1)}
- [ ] ç¬¬2æ¬¡å¤ä¹ ï¼ˆç»ƒä¹ åº”ç”¨ï¼‰ğŸ“… ${getDateAfterDays(3)}
- [ ] ç¬¬3æ¬¡å¤ä¹ ï¼ˆæ·±åŒ–ç†è§£ï¼‰ğŸ“… ${getDateAfterDays(7)}
- [ ] ç¬¬4æ¬¡å¤ä¹ ï¼ˆè€ƒå‰å·©å›ºï¼‰ğŸ“… ${getDateAfterDays(15)}

## ğŸ¯ æŒæ¡ç¨‹åº¦
- [ ] æ¦‚å¿µç†è§£ 
- [ ] å…¬å¼è®°å¿†
- [ ] ä¾‹é¢˜ä¼šåš
- [ ] å˜å¼åº”ç”¨
- [ ] ç»¼åˆè¿ç”¨

## ğŸ¤– AIå¯¹è¯è®°å½•
<details>
<summary>ç‚¹å‡»æŸ¥çœ‹å®Œæ•´å¯¹è¯å†…å®¹</summary>

\`\`\`
${dialogue.length > 2000 ? dialogue.substring(0, 2000) + '...\n[å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­]' : dialogue}
\`\`\`

</details>

---
**ğŸ“Š æ–‡ä»¶ä¿¡æ¯**  
- **åˆ›å»ºæ—¶é—´**ï¼š${today}
- **æ¥æº**ï¼šAIå¯¹è¯è‡ªåŠ¨æ•´ç†
- **æ–‡ä»¶åå»ºè®®**ï¼š\`${filename}.md\`
- **æ¨èä½ç½®**ï¼š\`${getRecommendedPath(subject)}\``;

            generatedCard = card;
            return card;
        }

        function analyzeDialogue(dialogue) {
            // æ”¹è¿›çš„å†…å®¹åˆ†æé€»è¾‘
            const lines = dialogue.split('\n').filter(line => line.trim());
            
            let concepts = [];
            let examples = [];
            let keyPoints = [];
            let warnings = [];
            let relatedTopics = [];
            let formulas = [];
            let solvingSteps = [];
            let extensions = [];
            let topicType = 'æ¦‚å¿µç†è§£';

            // æ›´ç²¾ç¡®çš„å…³é”®è¯åŒ¹é…
            for (let line of lines) {
                const lowerLine = line.toLowerCase();
                
                // æ¦‚å¿µå®šä¹‰
                if (lowerLine.includes('å®šä¹‰') || lowerLine.includes('æ¦‚å¿µ') || lowerLine.includes('ä»€ä¹ˆæ˜¯') || lowerLine.includes('ç†è§£ä¸º')) {
                    concepts.push('- ' + line.trim());
                    topicType = 'æ¦‚å¿µç†è§£';
                }
                
                // å…¬å¼å®šç†
                if (lowerLine.includes('å…¬å¼') || lowerLine.includes('å®šç†') || line.includes('=') || line.includes('\\') || line.includes('$')) {
                    formulas.push('- ' + line.trim());
                    topicType = 'å…¬å¼åº”ç”¨';
                }
                
                // ä¾‹é¢˜åˆ†æ
                if (lowerLine.includes('ä¾‹é¢˜') || lowerLine.includes('ä¾‹å­') || lowerLine.includes('è§£ï¼š') || lowerLine.includes('è§£é¢˜') || lowerLine.includes('æ±‚è§£')) {
                    examples.push('- ' + line.trim());
                    topicType = 'ä¾‹é¢˜ç»ƒä¹ ';
                }
                
                // è§£é¢˜æ­¥éª¤
                if (lowerLine.includes('æ­¥éª¤') || lowerLine.includes('æ–¹æ³•') || lowerLine.includes('æ€è·¯') || lowerLine.includes('è¿‡ç¨‹')) {
                    solvingSteps.push('- ' + line.trim());
                }
                
                // æ³¨æ„äº‹é¡¹
                if (lowerLine.includes('æ³¨æ„') || lowerLine.includes('å®¹æ˜“é”™') || lowerLine.includes('æ˜“é”™') || lowerLine.includes('å°å¿ƒ') || lowerLine.includes('é¿å…')) {
                    warnings.push('- ' + line.trim());
                }
                
                // ç›¸å…³çŸ¥è¯†ç‚¹
                if (lowerLine.includes('ç›¸å…³') || lowerLine.includes('è”ç³»') || lowerLine.includes('å…³è”') || lowerLine.includes('ç±»ä¼¼')) {
                    relatedTopics.push('- ' + line.trim());
                }
                
                // çŸ¥è¯†æ‹“å±•
                if (lowerLine.includes('æ‹“å±•') || lowerLine.includes('è¿›ä¸€æ­¥') || lowerLine.includes('æ·±å…¥') || lowerLine.includes('é«˜çº§')) {
                    extensions.push('- ' + line.trim());
                }
            }

            return {
                concepts: concepts.length > 0 ? concepts.join('\n') : '> ğŸ’¡ ä»AIå¯¹è¯ä¸­æå–çš„æ ¸å¿ƒæ¦‚å¿µå°†åœ¨è¿™é‡Œæ˜¾ç¤º',
                formulas: formulas.length > 0 ? formulas.join('\n') : '> ğŸ“ ç›¸å…³å…¬å¼å’Œå®šç†å°†åœ¨è¿™é‡Œæ˜¾ç¤º',
                examples: examples.length > 0 ? examples.join('\n') : '> ğŸ” å…·ä½“ä¾‹é¢˜åˆ†æå°†åœ¨è¿™é‡Œæ˜¾ç¤º',
                solvingSteps: solvingSteps.length > 0 ? solvingSteps.join('\n') : '> ğŸ¯ è§£é¢˜æ€è·¯å’Œæ–¹æ³•å°†åœ¨è¿™é‡Œæ˜¾ç¤º',
                warnings: warnings.length > 0 ? warnings.join('\n') : '> âš ï¸ éœ€è¦æ³¨æ„çš„æ˜“é”™ç‚¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º',
                relatedTopics: relatedTopics.length > 0 ? relatedTopics.join('\n') : '[[ç›¸å…³æ¦‚å¿µ1]] | [[ç›¸å…³æ¦‚å¿µ2]] | [[ç›¸å…³æ¦‚å¿µ3]]',
                extensions: extensions.length > 0 ? extensions.join('\n') : '> ğŸš€ çŸ¥è¯†ç‚¹çš„è¿›ä¸€æ­¥æ‹“å±•å°†åœ¨è¿™é‡Œæ˜¾ç¤º',
                topicType: topicType
            };
        }

        function getDateAfterDays(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0];
        }

        function getRecommendedPath(subject) {
            const pathMap = {
                'é«˜ç­‰æ•°å­¦': '01-é«˜ç­‰æ•°å­¦/',
                'çº¿æ€§ä»£æ•°': '02-çº¿æ€§ä»£æ•°/',
                '408æ•°æ®ç»“æ„': '03-408ä¸“ä¸šè¯¾/æ•°æ®ç»“æ„/',
                '408ç®—æ³•': '03-408ä¸“ä¸šè¯¾/ç®—æ³•/',
                '408è®¡ç½‘': '03-408ä¸“ä¸šè¯¾/è®¡ç®—æœºç½‘ç»œ/',
                '408æ“ä½œç³»ç»Ÿ': '03-408ä¸“ä¸šè¯¾/æ“ä½œç³»ç»Ÿ/'
            };
            return pathMap[subject] || 'AIå¯¹è¯æ•´ç†/';
        }

        function displayCard(card) {
            document.getElementById('cardPreview').textContent = card;
        }

        function downloadCard() {
            if (!generatedCard) {
                alert('è¯·å…ˆç”ŸæˆçŸ¥è¯†å¡ç‰‡ï¼');
                return;
            }

            const topic = document.getElementById('topic').value;
            const today = new Date().toISOString().split('T')[0];
            const filename = `${today}-${topic.replace(/\s+/g, '-')}.md`;

            downloadFile(generatedCard, filename);
        }

        function copyToClipboard() {
            if (!generatedCard) {
                alert('è¯·å…ˆç”ŸæˆçŸ¥è¯†å¡ç‰‡ï¼');
                return;
            }

            navigator.clipboard.writeText(generatedCard).then(() => {
                alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼å¯ä»¥ç›´æ¥åœ¨Obsidianä¸­ç²˜è´´ä½¿ç”¨ã€‚');
            }).catch(() => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = generatedCard;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function showObsidianGuide() {
            const guide = document.getElementById('obsidianGuide');
            guide.style.display = guide.style.display === 'none' ? 'block' : 'none';
        }

        // æ‰¹é‡å¤„ç†åŠŸèƒ½
        function addToBatch() {
            if (!generatedCard) {
                alert('è¯·å…ˆç”ŸæˆçŸ¥è¯†å¡ç‰‡ï¼');
                return;
            }

            const topic = document.getElementById('topic').value;
            const subject = document.getElementById('subject').value;
            const today = new Date().toISOString().split('T')[0];
            const filename = `${today}-${topic.replace(/\s+/g, '-')}.md`;

            const batchItem = {
                filename: filename,
                content: generatedCard,
                topic: topic,
                subject: subject,
                date: today
            };

            batchQueue.push(batchItem);
            updateBatchCount();
            alert(`âœ… "${topic}" å·²æ·»åŠ åˆ°æ‰¹é‡é˜Ÿåˆ—ï¼`);
            
            // æ¸…ç©ºå½“å‰è¡¨å•ï¼Œå‡†å¤‡ä¸‹ä¸€ä¸ª
            document.getElementById('topic').value = '';
            document.getElementById('dialogue').value = '';
            document.getElementById('output').style.display = 'none';
        }

        function showBatchQueue() {
            const queueDiv = document.getElementById('batchQueue');
            const listDiv = document.getElementById('batchList');
            
            if (batchQueue.length === 0) {
                alert('æ‰¹é‡é˜Ÿåˆ—ä¸ºç©ºï¼');
                return;
            }

            listDiv.innerHTML = batchQueue.map((item, index) => 
                `<div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; margin-bottom: 8px; border-radius: 8px;">
                    <div>
                        <strong>${item.topic}</strong><br>
                        <small style="color: #666;">${item.subject} | ${item.date}</small>
                    </div>
                    <button onclick="removeBatchItem(${index})" style="background: #ef4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">åˆ é™¤</button>
                </div>`
            ).join('');

            queueDiv.style.display = queueDiv.style.display === 'none' ? 'block' : 'none';
        }

        function removeBatchItem(index) {
            batchQueue.splice(index, 1);
            updateBatchCount();
            showBatchQueue();
        }

        function downloadAllCards() {
            if (batchQueue.length === 0) {
                alert('æ‰¹é‡é˜Ÿåˆ—ä¸ºç©ºï¼');
                return;
            }

            // åˆ›å»ºZIPæ–‡ä»¶ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
            const zip = createZipContent();
            downloadFile(zip, `è€ƒç ”çŸ¥è¯†å¡ç‰‡-${new Date().toISOString().split('T')[0]}.txt`);
        }

        function createZipContent() {
            let content = `# è€ƒç ”çŸ¥è¯†å¡ç‰‡æ‰¹é‡å¯¼å‡º\nå¯¼å‡ºæ—¶é—´ï¼š${new Date().toLocaleString()}\næ€»è®¡ï¼š${batchQueue.length}ä¸ªå¡ç‰‡\n\n`;
            content += '=' .repeat(50) + '\n\n';

            batchQueue.forEach((item, index) => {
                content += `## æ–‡ä»¶ ${index + 1}: ${item.filename}\n\n`;
                content += item.content;
                content += '\n\n' + '='.repeat(50) + '\n\n';
            });

            return content;
        }

        function clearBatch() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰¹é‡é˜Ÿåˆ—å—ï¼Ÿ')) {
                batchQueue = [];
                updateBatchCount();
                document.getElementById('batchQueue').style.display = 'none';
            }
        }

        function updateBatchCount() {
            document.getElementById('batchCount').textContent = batchQueue.length;
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>